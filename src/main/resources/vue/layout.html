<!DOCTYPE html>
<html lang="de" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <meta content="IE=edge" http-equiv="X-UA-Compatible" />
    <meta content="Michael Büchner" name="author" />
    <link href="https://stackpath.bootstrapcdn.com/bootswatch/4.3.1/spacelab/bootstrap.min.css" rel="stylesheet" integrity="sha384-sZG5VVk41YqhJjYXgJFoRVd3d2AdDgy4oyIytQJMGx/Mizz1N+5bgKQBSCGfKQnP" crossorigin="anonymous">
    <title>IIIF Presentation API | DDBlabs</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.10/vue.min.js" integrity="sha256-chlNFSVx3TdcQ2Xlw7SvnbLAavAQLO0Y/LBiWX04viY=" crossorigin="anonymous"></script>
    @componentRegistration
  </head>
  <body>
    <br/>
    <div class="container">
      <div class="jumbotron">
        <h1 class="display-4 text-truncate">
          <a id="headerurl" href="#" style="text-decoration: none;">IIIF Presentation API</a>
        </h1>
        <p class="lead text-truncate">Test- und Entwicklungsumgebung für DDBlabs</p>
        <hr class="my-4" />
        <div class="row">
          <div class="col-md-4 order-md-2 mb-4">
            <h4 class="d-flex justify-content-between align-items-center mb-3">
              <span class="text-muted">Tools</span>
              <!-- <span class="badge badge-secondary badge-pill">3</span> -->
            </h4>
            <div class="list-group">
              <a class="list-group-item list-group-item-action flex-column align-items-start disabled" href="#" id="mirador2link" target="_blank">
                <div class="d-flex w-100 justify-content-between">
                  <h6 class="mb-1">Mirador 2</h6>
                </div>
                <small class="text-muted">Öffnet das Manifest mit Mirador 2.7.0</small>
              </a>
              <a class="list-group-item list-group-item-action flex-column align-items-start disabled" href="#" id="mirador3link" target="_blank">
                <div class="d-flex w-100 justify-content-between">
                  <h6 class="mb-1">Mirador 3</h6>
                </div>
                <small class="text-muted">Öffnet das Manifest mit Mirador 3.0.0-alpha.16</small>
              </a>
              <a class="list-group-item list-group-item-action flex-column align-items-start disabled" href="#" id="universalviewerlink" target="_blank">
                <div class="d-flex w-100 justify-content-between">
                  <h6 class="mb-1">Universal Viewer 2</h6>
                </div>
                <small class="text-muted">Öffnet das Manifest mit dem Universal Viewer 2</small>
              </a>
            </div>
          </div>
          <div class="col-md-8 order-md-1" id="main-vue">
            <h4 class="mb-3">Dateien</h4> @routeComponent </div>
          <!-- row -->
        </div>
        <div class="row">
          <div class="col-md-12 order-md-12" id="main-code">
            <!--Accordion wrapper-->
            <div aria-multiselectable="true" class="accordion md-accordion" id="accordionEx" role="tablist">
              <!-- Accordion card -->
              <div class="card">
                <!-- Card header -->
                <div class="card-header" id="headingTwo2" role="tab">
                  <a aria-controls="collapseTwo2" aria-expanded="false" class="nav-link disabled" data-parent="#accordionEx" data-toggle="collapse" href="#collapseTwo2" id="validatorlink">
                    <h6 class="mb-0">Presentation API-Validator</h6>
                  </a>
                </div>
                <!-- Card body -->
                <div aria-labelledby="headingTwo2" class="collapse" data-parent="#accordionEx" id="collapseTwo2" role="tabpanel">
                  <div class="card-body">
                      <div id="validatorerrors" class="alert alert-danger d-none" role="alert">
                      <h4 class="alert-heading">Fehler</h4>
                      <hr />
                      <p class="mb-0" id="validation-errors">Keine Fehler :-)</p>
                    </div>
                    <div id="validatorwarnings" class="alert alert-warning d-none" role="alert">
                      <h4 class="alert-heading">Warnungen</h4>
                      <hr />
                      <p class="mb-0" id="validation-warnings">Keine Fehler :-)</p>
                    </div>
                    <a aria-pressed="true" class="btn btn-primary" href="https://iiif.io/api/presentation/validator/service/" role="button" target="_blank">Validation Service</a>
                    <a aria-pressed="true" class="btn btn-secondary" href="#" id="universalviewerdirectlink" role="button" target="_blank">JSON anzeigen</a>
                  </div>
                </div>
              </div>
              <!-- Accordion card -->
              <div class="card">
                <!-- Card header -->
                <div class="card-header" id="headingOne1" role="tab">
                  <a aria-controls="collapseOne1" aria-expanded="false" class="nav-link disabled" data-parent="#accordionEx" data-toggle="collapse" href="#collapseOne1" id="manifestlink">
                    <h6 class="mb-0">Manifest</h6>
                  </a>
                </div>
                <!-- Card body -->
                <div aria-labelledby="headingOne1" class="collapse" data-parent="#accordionEx" id="collapseOne1" role="tabpanel">
                  <div class="card-body">
                    <div id="manifesterrors" class="alert alert-danger d-none" role="alert">
                        <h4 class="alert-heading">Fehler</h4>
                        <hr />
                        <p class="mb-0" id="manifesterrorstext">Keine Fehler :-)</p>
                    </div>
                        <div id="sourceframeframe" class="embed-responsive embed-responsive-4by3 mb-3 d-none">
                            <iframe class="embed-responsive-item" id="sourceframe" src="#" allowfullscreen></iframe>
                        </div>
                      <a aria-pressed="true" class="btn btn-primary" href="#" id="apilink" role="button" target="_blank">Öffnen</a>
                  </div>
                </div>
              </div>
            </div>
            <!-- main -->
          </div>
          <!-- row -->
        </div>
        <!-- jumbotron -->
      </div>
    </div>
    <script crossorigin="anonymous" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script crossorigin="anonymous" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script>
// get url parameter
var getUrlParameter = function getUrlParameter(sParam) {
    var sPageURL = window.location.search.substring(1),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;

    for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

        if (sParameterName[0] === sParam) {
            return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
        }
    }
};

$(document).ready(function() {

    $.ajaxSetup({ cache: false });
    $("#headerurl").attr("href", Vue.prototype.$javalin.state.baseurl);
    $("#manifestlink").removeClass("disabled");

    new Vue({
        el: "#main-vue"
    });

    if (getUrlParameter('f')) {
        // show JSON source code
        const url = Vue.prototype.$javalin.state.baseurl + "/api/file?f=" + getUrlParameter('f');
        $("#sourceframe").load(url + "&rand=" + Math.floor(Math.random() * 100000),
            function(responseText, textStatus, XMLHttpRequest) {
                if (textStatus === "success" || textStatus === "notmodified") {
                    $("#sourceframe").attr("src", url + "&rand=" + Math.floor(Math.random() * 100000));
                    $("#sourceframeframe").removeClass("d-none");
                } else {
                    $("#manifesterrorstext").html($.parseJSON(responseText)['message'].replace("/\n/g", "<br />"));
                    $("#manifesterrors").removeClass("d-none");
                }
                $("#apilink").attr("href", url + "&rand=" + Math.floor(Math.random() * 100000));
                $("#manifestlink").removeClass("disabled");
        });
        
        // validation
        $("#mirador2link").attr("href", Vue.prototype.$javalin.state.baseurl + "/mirador-2.html?manifest=" + encodeURIComponent(url) + "&rand=" + Math.floor(Math.random() * 100000));
        $("#mirador2link").removeClass("disabled");
        $("#mirador3link").attr("href", Vue.prototype.$javalin.state.baseurl + "/mirador-3.html?manifest=" + encodeURIComponent(url) + "&rand=" + Math.floor(Math.random() * 100000));
        $("#mirador3link").removeClass("disabled");
        $("#universalviewerlink").attr("href", "https://universalviewer.io/uv.html?manifest=" + encodeURIComponent(url) + "&rand=" + Math.floor(Math.random() * 100000));
        $("#universalviewerlink").removeClass("disabled");
        $("#universalviewerdirectlink").attr("href", "https://iiif.io/api/presentation/validator/service/validate?format=json&amp;version=2.1&amp;url=" + encodeURIComponent(url) + "&rand=" + Math.floor(Math.random() * 100000));

        $.getJSON("https://iiif.io/api/presentation/validator/service/validate?format=json&amp;version=2.1&amp;url=" + encodeURIComponent(url) + "&rand=" + Math.floor(Math.random() * 100000), function(data) {
            if ($.isArray(data['error'])) {
                var items = [];
                $.each(data['error'], function(key, val) {
                    items.push("<li id=&quot;error-item-" + key + "&quot;>" + val + "</li>");
                });
                if (items.length > 0) {
                    $("#validation-errors").empty();
                }
                $("<ol></ol>", {
                    "class": "validation-error-list",
                    html: items.join("")
                }).appendTo("#validation-errors");
                $("#validatorerrors").removeClass("d-none");
            } else if (data['error'] && data['error'] !== "None") {
                $("#validation-errors").html(data['error']);
                $("#validatorerrors").removeClass("d-none");
            }

            if ($.isArray(data['warnings'])) {
                var items = [];
                $.each(data['warnings'], function(key, val) {
                    items.push("<li id=&quot;warnings-item-" + key + "&quot;>" + val + "</li>");
                });
                if (items.length > 0) {
                    $("#validation-warnings").empty();
                }
                $("<ol></ol>", {
                    "class": "validation-warnings-list",
                    html: items.join("")
                }).appendTo("#validation-warnings");
                $("#validatorwarnings").removeClass("d-none");
            } else if (data['warnings']) {
                $("#validation-warnings").html(data['warnings']);
                $("#validatorwarnings").removeClass("d-none");
            }
        }).done(function() {
            $("#validatorlink").removeClass("disabled");
        });
    }
});
    </script>
  </body>
</html>
